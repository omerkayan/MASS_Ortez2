# MASS_Ortez
Buradaki sayfanın dili Türkçedir.

Kaynak 1: https://github.com/lsw9021/MASS <br />
Kaynak 2: https://github.com/koonyook/muscle-from-kinematic <br />
Kaynak 3: https://github.com/NRM-group/MASS_EXO <br />

Makale 1: Muscle-driven virtual human motion generation approachbased on deep reinforcement learning <br />
Makale 2: Muscle Activation Analysis from Gait Kinematics and Reinforcement Learning <br />
Makale 3: Generative GaitNet <br />
Makale 4: Robust Walking Control of a Lower Limb Rehabilitation Exoskeleton Coupled with a Musculoskeletal Model via Deep Reinforcement Learning <br />
Makale 5: Learning Walking on a Musculoskeletal Human System with a Prosthesis <br />
Makale 6: Scalable Muscle-Actuated Human Simulation and Control <br />
Makale 7: State of the Art Review of Active and Passive Knee Orthoses <br />
Makale 8: Learning a Control Policy for Fall Prevention on an Assistive Walking Device <br />
Makale 9: Understanding the stability of deep control policies for biped locomotion <br />

## Çalışma Ortamı
Buradaki tüm çalışmalar Ubuntu 18.04'te yapılmıştır.

### Yükleme: TinyXML, Eigen, OpenGL, assimp, Python3, vb. ...

```bash
sudo apt-get install libtinyxml-dev libeigen3-dev libxi-dev libxmu-dev freeglut3-dev libassimp-dev libpython3-dev python3-tk python3-numpy virtualenv ipython3 cmake-curses-gui
```

### Yükleme: python3 ile beraber boost (1.66)
* "Boost" kütüphanelerini kaynak kodundan yükleyiniz (apt-get vb. ile değil.).

* 1.66 üzeri sürümlerle "boost" kaynaklarını indirin (https://www.boost.org/users/history/version_1_66_0.html). <br />

* İndirilen kaynağı derleyin ve yükleyin.

```bash
cd /path/to/boost_1_xx/
./bootstrap.sh --with-python=python3
sudo ./b2 --with-python --with-filesystem --with-system --with-regex install
```
* Kütüphanelerin dizinlere düzgün bir şekilde yüklenip yüklenmediği kontrol edilebilir. `/usr/local/`. (or `/usr/`)

* Eğer başarıyla kurulmuşsa, aşağıdaki dosya yolları oluşmuş olmalıdır.

"Include"
* `/usr/local/include/boost/`
* `/usr/local/include/boost/python/`
* `/usr/local/include/boost/python/numpy`

"Lib"
* `/usr/local/lib/libboost_filesystem.so`
* `/usr/local/lib/libboost_python3.so`
* `/usr/local/lib/libboost_numpy3.so`

### Yükleme: DART 6.X
https://dartsim.github.io/install_dart_on_ubuntu.html
```bash
apt-add-repository ppa:dartsim/ppa
apt-get install libdart6-all-dev
```
### İndirme: MASS_Ortez
```bash
git clone https://github.com/omerkayan/MASS_Ortez.git
```

### Yükleme: PIP ile Pytorch, numpy, matplotlib
* Önce virtualenv etkinleştirmelidir.
```bash
virtualenv ../MASS_Ortez/venv --python=python3
source ../MASS_Ortez/venv/bin/activate
```
* Daha sonra aşağıdakiler yüklenir.
```bash
pip3 install torch torchvision
pip3 install numpy matplotlib ipython
```

## Derleme ve çalıştırma
```bash
cd ../MASS_Ortez
mkdir build
cd build
cmake .. 
make -j8
```

* Eğitimi çalıştırma
```bash
source /path/to/virtualenv/activate ***Yanlışlık var. Eğer venv etkinse tekrardan etkinleştirmeye gerek yoktur.
cd ../MASS_Ortez/python
python3 main.py -d ../MASS_Ortez/data/metadata.txt
```
<br /> Virtualenv sonlandırılmak istenirse;
```bash
deactivate
```

* Tüm eğitim ağları ../MASS_Ortez/nn klasörüne kaydedilir. Aşağıdaki komut ile eğitime devam edilebilir.
```bash
python3 main.py -d ../MASS_Ortez/data/metadata.txt -m current
```

* GUI'de eğitim sonucunun 3 boyutlu görselleştirmesini işlemek
```bash
source /path/to/virtualenv/activate ***Yanlışlık var. Eğer venv etkinse tekrardan etkinleştirmeye gerek yoktur.
cd ../MASS_Ortez/build
./render/render ../MASS_Ortez/data/metadata.txt ../MASS_Ortez/nn/xxx.pt ../MASS_Ortez/nn/xxx_muscle.pt
```

* GUI'yi yönetme tuşları: <br />
Boşluk tuşu: Benzetimi başlat/durdur. <br />
R: Benzetimi yeniden başlat. <br />
O: Kutu ve iskelet yapısı arasında geçiş yapma. <br />
F: Modeli sürekli kameradan takip etme. <br />
S: Benzetimi bir adım ileri götürme. <br /> <br />
Eğer benzetim görüntüsü video olarak kaydedilmek isternirse bu komutlar çalıştırılmalıdır. Video Ctrl+C yaparak sonlandırılır ve "Home" dosya yoluna "out.ogv "olarak kaydedilir.
```bash
sudo apt install recordmydesktop
recordmydesktop --on-the-fly-encoding
```

* Kas aktivasyonlarını dışarı aktarma <br />
Çıktı ../MASS_Ortez/build klasörüne kaydedilir.
```bash
source /path/to/virtualenv/activate ***Yanlışlık var. Eğer venv etkinse tekrardan etkinleştirmeye gerek yoktur.
cd ../MASS_Ortez/build
./actExport/actExport ../MASS_Ortez/data/metadata.txt ../MASS_Ortez/nn/xxx.pt ../MASS_Ortez/nn/xxx_muscle.pt
```

* Metadata dosyası (çeviri yapılacak) <br />
The metadata file is used to tell the program where is the motion capture file, skeleton, and muscle details.
All these resources can be generated by source code in data_preporcessing directory by running 01, 02, 04, and 05 python script in order.
